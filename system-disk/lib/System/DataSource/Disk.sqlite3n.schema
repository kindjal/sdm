PRAGMA foreign_keys = ON;
DROP TABLE IF EXISTS disk_gpfs_node;
DROP TABLE IF EXISTS disk_gpfs_fs_perf;
DROP TABLE IF EXISTS disk_gpfs_disk_perf;
DROP TABLE IF EXISTS disk_user;
DROP TABLE IF EXISTS disk_group;
DROP TABLE IF EXISTS disk_array;
DROP TABLE IF EXISTS disk_host_array;
DROP TABLE IF EXISTS disk_host;
DROP TABLE IF EXISTS disk_volume;
DROP TABLE IF EXISTS disk_export;
DROP TABLE IF EXISTS disk_filer_host;
DROP TABLE IF EXISTS disk_filer;
CREATE TABLE IF NOT EXISTS disk_user (
  email         VARCHAR(255) NOT NULL PRIMARY KEY,
  created       DATE,
  last_modified DATE
);
CREATE TABLE IF NOT EXISTS disk_filer (
  name          VARCHAR(255) PRIMARY KEY,
  status        UNSIGNED INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  filesystem    VARCHAR(255),
  comments      VARCHAR(255),
  created       DATE,
  last_modified DATE
);
CREATE TABLE IF NOT EXISTS disk_host (
  hostname      VARCHAR(255) NOT NULL PRIMARY KEY,
  status        UNSIGNED INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  os            VARCHAR(255),
  location      VARCHAR(255),
  comments      VARCHAR(255),
  master        UNSIGNED INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  created       DATE,
  last_modified DATE
);
CREATE TABLE IF NOT EXISTS disk_group (
  name          VARCHAR(255) NOT NULL PRIMARY KEY,
  permissions   UNSIGNED INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  sticky        UNSIGNED INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  subdirectory  VARCHAR(255) NOT NULL,
  unix_uid      UNSIGNED INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  unix_gid      UNSIGNED INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  username      VARCHAR(255),
  created       DATE,
  last_modified DATE
);
CREATE TABLE IF NOT EXISTS disk_filer_host (
  filername     VARCHAR(255),
  hostname      VARCHAR(255),
  PRIMARY KEY(filername,hostname),
  CONSTRAINT disk_filer_host_filername_fk FOREIGN KEY (filername) REFERENCES disk_filer (name) DEFERRABLE INITIALLY DEFERRED,
  CONSTRAINT disk_filer_host_hostname_fk FOREIGN KEY (hostname) REFERENCES disk_host (hostname) DEFERRABLE INITIALLY DEFERRED
);
CREATE TABLE IF NOT EXISTS disk_export (
  id            INTEGER PRIMARY KEY AUTOINCREMENT,
  filername     VARCHAR(255) NOT NULL CONSTRAINT disk_export_fk REFERENCES disk_filer (name) DEFERRABLE INITIALLY DEFERRED,
  physical_path VARCHAR(255) NOT NULL,
  created       DATE,
  last_modified DATE,
  CONSTRAINT disk_export_uq UNIQUE (filername,physical_path)
);
CREATE TABLE IF NOT EXISTS disk_volume (
  id            INTEGER PRIMARY KEY AUTOINCREMENT,
  mount_path    VARCHAR(255) NOT NULL,
  total_kb      UNSIGNED INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  used_kb       UNSIGNED INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  created       DATE,
  last_modified DATE,
  disk_group    VARCHAR(255) CONSTRAINT disk_volume_fk REFERENCES disk_group (name) ON DELETE SET NULL DEFERRABLE INITIALLY DEFERRED
);
CREATE TABLE IF NOT EXISTS disk_mount (
  export_id     INTEGER,
  volume_id     INTEGER,
  PRIMARY KEY(export_id,volume_id),
  CONSTRAINT disk_mount_export_fk FOREIGN KEY(export_id) REFERENCES disk_export (id) DEFERRABLE INITIALLY DEFERRED,
  CONSTRAINT disk_mount_volume_fk FOREIGN KEY(volume_id) REFERENCES disk_volume (id) DEFERRABLE INITIALLY DEFERRED
);
CREATE TABLE IF NOT EXISTS disk_array (
  name          VARCHAR(255) NOT NULL PRIMARY KEY,
  model         VARCHAR(255),
  type          VARCHAR(255),
  arraysize     UNSIGNED INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  created       DATE,
  last_modified DATE,
  hostname      VARCHAR(255) CONSTRAINT disk_array_host_fk REFERENCES disk_host (hostname) DEFERRABLE INITIALLY DEFERRED
);
CREATE TABLE IF NOT EXISTS disk_host_array (
  hostname      VARCHAR(255),
  arrayname     VARCHAR(255),
  PRIMARY KEY(hostname,arrayname),
  CONSTRAINT disk_host_array_hostname_fk FOREIGN KEY(hostname) REFERENCES disk_host (hostname) DEFERRABLE INITIALLY DEFERRED,
  CONSTRAINT disk_host_array_arraynme_fk FOREIGN KEY(arrayname) REFERENCES disk_array (name) DEFERRABLE INITIALLY DEFERRED
);
CREATE TABLE IF NOT EXISTS disk_gpfs_node (
  gpfsNodeName          VARCHAR(255) PRIMARY KEY,
  gpfsNodeIP            VARCHAR(255) DEFAULT '' NOT NULL ON CONFLICT REPLACE,
  gpfsNodePlatform      VARCHAR(255) DEFAULT '' NOT NULL ON CONFLICT REPLACE,
  gpfsNodeStatus        VARCHAR(255) DEFAULT '' NOT NULL ON CONFLICT REPLACE,
  gpfsNodeFailureCount  VARCHAR(255) DEFAULT '' NOT NULL ON CONFLICT REPLACE,
  gpfsNodeThreadWait    VARCHAR(255) DEFAULT '' NOT NULL ON CONFLICT REPLACE,
  gpfsNodeHealthy       VARCHAR(255) DEFAULT '' NOT NULL ON CONFLICT REPLACE,
  gpfsNodeDiagnosis     VARCHAR(255) DEFAULT '' NOT NULL ON CONFLICT REPLACE,
  gpfsNodeVersion       VARCHAR(255) DEFAULT '' NOT NULL ON CONFLICT REPLACE,
  created               DATE,
  last_modified         DATE,
  CONSTRAINT disk_gpfs_node_hostname_fk FOREIGN KEY (gpfsNodeName) REFERENCES disk_host (hostname) DEFERRABLE INITIALLY DEFERRED
);
CREATE TABLE IF NOT EXISTS disk_gpfs_disk_perf (
  id                            INTEGER PRIMARY KEY AUTOINCREMENT,
  volume_id                     INTEGER NOT NULL,
  gpfsDiskPerfName              VARCHAR(255) DEFAULT '' NOT NULL ON CONFLICT REPLACE,
  gpfsDiskPerfFSName            VARCHAR(255) DEFAULT '' NOT NULL ON CONFLICT REPLACE,
  gpfsDiskPerfStgPoolName       VARCHAR(255) DEFAULT '' NOT NULL ON CONFLICT REPLACE,
  gpfsDiskReadTimeL             INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskReadTimeH             INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskWriteTimeL            INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskWriteTimeH            INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskLongestReadTimeL      INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskLongestReadTimeH      INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskLongestWriteTimeL     INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskLongestWriteTimeH     INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskShortestReadTimeL     INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskShortestReadTimeH     INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskShortestWriteTimeL    INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskShortestWriteTimeH    INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskReadBytesL            INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskReadBytesH            INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskWriteBytesL           INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskWriteBytesH           INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskReadOps               INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsDiskWriteOps              INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  created                       DATE,
  last_modified                 DATE,
  CONSTRAINT disk_gpfs_disk_perf_fk FOREIGN KEY (volume_id) REFERENCES disk_volume (id) DEFERRABLE INITIALLY DEFERRED
);
CREATE TABLE IF NOT EXISTS disk_gpfs_fs_perf (
  id                            INTEGER PRIMARY KEY AUTOINCREMENT,
  volume_id                     INTEGER NOT NULL,
  gpfsFileSystemPerfName        VARCHAR(255) NOT NULL,
  gpfsFileSystemBytesReadL      INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemBytesReadH      INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemBytesCacheL     INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemBytesCacheH     INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemBytesWrittenL   INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemBytesWrittenH   INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemReads           INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemCaches          INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemWrites          INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemOpenCalls       INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemCloseCalls      INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemReadCalls       INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemWriteCalls      INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemReaddirCalls    INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemInodesWritten   INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemInodesRead      INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemInodesDeleted   INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemInodesCreated   INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemStatCacheHit    INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  gpfsFileSystemStatCacheMiss   INTEGER DEFAULT 0 NOT NULL ON CONFLICT REPLACE,
  created                       DATE,
  last_modified                 DATE,
  CONSTRAINT disk_gpfs_fs_perf_fk FOREIGN KEY (volume_id) REFERENCES disk_volume (id) DEFERRABLE INITIALLY DEFERRED
);
